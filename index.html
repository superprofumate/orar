<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orar disponibilitƒÉ»õi | Luni‚ÄìVineri 07:00‚Äì21:00</title>
  <meta name="description" content="SelecteazƒÉ rapid orele disponibile, coreleazƒÉ cu numele »ôi gestioneazƒÉ modificƒÉrile (undo, reset, salvare, trimitere)." />
  <meta name="robots" content="noindex, nofollow" />
  <style>
    :root{
      --bg:#f7f8fb;
      --panel:#ffffff;
      --text:#0f172a; /* slate-900 */
      --muted:#64748b; /* slate-500 */
      --line:#e2e8f0; /* slate-200 */
      --line-strong:#cbd5e1; /* slate-300 */
      --accent:#2563eb; /* blue-600 */
      --accent-2:#0ea5e9; /* cyan-500 */
      --ok:#16a34a; /* green-600 */
      --danger:#ef4444; /* red-500 */
      --radius:16px;
      --shadow:0 12px 35px rgba(15,23,42,.08);
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#f9fafb 0%, #f3f4f6 30%, #eef2f7 100%); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color:var(--text)}

    .container{max-width:var(--maxw);margin:0 auto;padding:22px}

    header{position:sticky;top:0;z-index:20; background:rgba(255,255,255,.75); backdrop-filter: blur(10px); border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;min-height:64px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand .logo{display:grid;place-items:center;width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:white; font-weight:900}
    .sub{font-size:12px;color:var(--muted)}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card .inner{padding:18px}

    .toolbar{display:grid;gap:12px}
    @media (min-width: 900px){ .toolbar{grid-template-columns: 1.6fr auto auto auto auto} }

    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--line); outline:none; background:#fff}
    input[type="text"]:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,.15)}

    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--text);cursor:pointer;user-select:none;transition:transform .05s ease, box-shadow .2s, background .2s}
    .btn:hover{box-shadow:0 4px 18px rgba(2,6,23,.08)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:transparent;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff}
    .btn.ok{background:#f0fdf4;border-color:#bbf7d0}
    .btn.danger{background:#fef2f2;border-color:#fecaca}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.loading{pointer-events:none; opacity:.9}
    .btn .spinner{width:14px;height:14px;border-radius:999px;border:2px solid #ffffff80;border-top-color:#ffffff;display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .legend{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--muted);margin-top:10px}
    .swatch{width:16px;height:16px;border-radius:5px;background:rgba(37,99,235,.14); box-shadow:inset 0 0 0 2px rgba(37,99,235,.6)}

    .status{margin-top:8px;font-size:14px;color:var(--muted)}

    .grid-wrap{overflow:auto;border-top:1px solid var(--line); border-radius:0 0 var(--radius) var(--radius)}
    .grid{display:grid;grid-template-columns: 120px repeat(5, 1fr); min-width:780px; grid-auto-rows: 42px}

    .cell{border-right:1px solid var(--line);border-bottom:1px solid var(--line);min-height:42px;display:grid;place-items:center;position:relative}
    .cell.head{background:#fafafa;color:#0f172a;font-weight:700;position:sticky;top:0;z-index:5; cursor:pointer}
    .cell.hour{background:#fafafa;color:#334155;font-weight:600;justify-content:start;padding-left:12px;position:sticky;left:0;z-index:4; cursor:pointer}
    .cell.slot{cursor:pointer; transition: background .12s ease, box-shadow .12s ease}
    .cell.slot:hover{background:#f7fbff}
    .cell.slot.selected{background:rgba(37,99,235,.12); box-shadow: inset 0 0 0 2px rgba(37,99,235,.55)}
    .cell.slot:focus{outline:2px solid rgba(37,99,235,.5); outline-offset:-3px}
    .cell.head.active, .cell.hour.active{background:#eef2ff}

    footer{color:var(--muted);font-size:12px;padding:18px;text-align:center}

    /* Toast */
    .toast{position:fixed;right:20px;bottom:20px;display:grid;gap:10px;z-index:50}
    .t{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;box-shadow:var(--shadow);font-size:14px}
    .t.ok{border-color:#86efac}
    .t.err{border-color:#fecaca}
    .t.info{border-color:#cbd5e1}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo">O</div>
        <div>
          Orar disponibilitƒÉ»õi
          <div class="sub">Luni‚ÄìVineri ¬∑ 07:00‚Äì21:00 ¬∑ selec»õie multiplƒÉ</div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="inner">
        <div class="toolbar">
          <div>
            <label for="name">Nume</label>
            <input id="name" type="text" placeholder="Introdu numele (obligatoriu la trimitere)" />
          </div>
          <button id="undoBtn" class="btn" disabled>‚Ü∂ Undo</button>
          <button id="resetBtn" class="btn danger">ReseteazƒÉ orar</button>
          <button id="saveBtn" class="btn">üíæ SalveazƒÉ modificƒÉri</button>
          <button id="sendBtn" class="btn primary" disabled>‚úàÔ∏è Trimite date</button>
        </div>
        <div class="legend"><span class="swatch"></span> Slot selectat (click pentru a comuta ¬∑ click & drag pentru selec»õie continuƒÉ ¬∑ Space/Enter pentru tastaturƒÉ)</div>
        <div class="status" id="status" aria-live="polite">0 sloturi selectate</div>
      </div>
      <div class="grid-wrap">
        <div id="grid" class="grid" aria-label="Orar selectabil Luni‚ÄìVineri, 07:00‚Äì21:00" role="grid"></div>
      </div>
    </section>

    <footer>¬© <span id="y"></span> Orar disponibilitƒÉ»õi. Datele se pƒÉstreazƒÉ local √Æn browser (localStorage).</footer>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    (function(){
      const days = ["Luni","Mar»õi","Miercuri","Joi","Vineri"]; // coloane
      const startHour = 7; // inclusiv
      const endHour = 21; // inclusiv ‚Äî r√¢ndul 21:00 e selectabil

      const grid = document.getElementById('grid');
      const nameInput = document.getElementById('name');
      const undoBtn = document.getElementById('undoBtn');
      const resetBtn = document.getElementById('resetBtn');
      const saveBtn = document.getElementById('saveBtn');
      const sendBtn = document.getElementById('sendBtn');
      const status = document.getElementById('status');
      const toast = document.getElementById('toast');

      const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxmgnUHjcUFmWl9qEhwLcGrbtkviQUjS8AfWYzkdOnJbu8JIHtpiDNDj6ZJEpZtk1Mq/exec';

      const keyOf = (d,h) => `${d}|${String(h).padStart(2,'0')}:00`;

      const selected = new Set();
      let dragging = false;
      let dragMode = null; // 'select'|'deselect'
      let currentBatch = [];
      const history = []; // {changes:[{id,prev,next}]}

      const dayHeads = []; // referin»õe la header-ele de zile
      const hourHeads = []; // referin»õe la header-ele de ore (include 21:00)

      // HEADER (col»õul st√¢nga-sus)
      const corner = cell('head','Ora');
      corner.style.cursor = 'default';
      grid.appendChild(corner);

      // Header zile + click = selecteazƒÉ/deselecteazƒÉ toatƒÉ ziua
      days.forEach((d, di)=>{
        const h = cell('head', d);
        h.classList.add('day-head');
        h.tabIndex = 0;
        h.addEventListener('click', ()=> toggleDay(di));
        h.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggleDay(di);} });
        dayHeads.push(h);
        grid.appendChild(h);
      });

      // ROWS 07:00 .. 21:00 (toate r√¢ndurile au celule selectabile)
      for (let h = startHour; h <= endHour; h++){
        const label = `${String(h).padStart(2,'0')}:00`;
        const hr = cell('hour', label);
        hr.classList.add('hour-head');
        hr.tabIndex = 0;
        hr.addEventListener('click', ()=> toggleHour(h));
        hr.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggleHour(h);} });
        hourHeads.push(hr);
        grid.appendChild(hr);

        for (let d = 0; d < days.length; d++){
          const id = keyOf(days[d], h);
          const c = cell('slot','');
          c.tabIndex = 0; // accesibilitate
          c.dataset.id = id;
          c.dataset.di = d;
          c.dataset.h = h;
          c.setAttribute('role','gridcell');
          c.setAttribute('aria-label', `${days[d]} ${label}`);
          c.addEventListener('pointerdown', onPointerDown);
          c.addEventListener('pointerenter', onPointerEnter);
          c.addEventListener('pointerover', onPointerEnter);
          c.addEventListener('mouseover', onHoverIn);
          c.addEventListener('mouseout', onHoverOut);
          c.addEventListener('keydown', onKey);
          grid.appendChild(c);
        }
      }

      function cell(kind, text){
        const div = document.createElement('div');
        div.className = `cell ${kind}`;
        if (text) div.textContent = text;
        return div;
      }

      // Fallback pentru CSS.escape (nu toate browserele √Æl au)
      function escSel(s){
        if (window.CSS && typeof CSS.escape === 'function') return CSS.escape(s);
        return String(s).replace(/([\\.\[\]#,:>+~*^$|()])/g, "\\$1");
      }
      function findCell(id){
        return grid.querySelector(`.cell.slot[data-id="${escSel(id)}"]`);
      }

      function setSelected(id, val){
        const el = findCell(id);
        const was = selected.has(id);
        if (val && !was){ selected.add(id); el?.classList.add('selected'); return true; }
        if (!val && was){ selected.delete(id); el?.classList.remove('selected'); return true; }
        return false;
      }

      function beginBatch(){ currentBatch = []; }
      function recordChange(id, prev, next){ if(prev!==next) currentBatch.push({id, prev, next}); }
      function endBatch(){ if(currentBatch.length){ history.push({changes:[...currentBatch]}); currentBatch=[]; refreshUndo(); } }

      function onPointerDown(e){
        if (!e.currentTarget.classList.contains('slot')) return;
        e.preventDefault();
        dragging = true; document.body.style.userSelect='none';
        const id = e.currentTarget.dataset.id;
        const was = selected.has(id);
        dragMode = was ? 'deselect' : 'select';
        beginBatch();
        setSelected(id, dragMode==='select');
        recordChange(id, was, !was);
        updateStatus();
      }
      function onPointerEnter(e){
        if (!dragging) return;
        if (!e.currentTarget.classList.contains('slot')) return;
        const id = e.currentTarget.dataset.id;
        const was = selected.has(id);
        const want = dragMode==='select';
        const changed = setSelected(id, want);
        if (changed) recordChange(id, was, want);
        updateStatus();
      }
      document.addEventListener('pointerup', ()=>{
        if (dragging){ dragging=false; document.body.style.userSelect=''; endBatch(); updateStatus(); }
      });

      function onKey(e){
        if (e.key===' ' || e.key==='Enter'){
          e.preventDefault();
          const id = e.currentTarget.dataset.id;
          const was = selected.has(id);
          beginBatch();
          setSelected(id, !was); // toggle la key
          recordChange(id, was, !was);
          endBatch();
          updateStatus();
        }
      }

      // Hover highlight pentru un look profesionist
      function onHoverIn(e){
        const di = Number(e.currentTarget.dataset.di);
        const h = Number(e.currentTarget.dataset.h);
        dayHeads[di]?.classList.add('active');
        hourHeads[h - startHour]?.classList.add('active');
      }
      function onHoverOut(e){
        const di = Number(e.currentTarget.dataset.di);
        const h = Number(e.currentTarget.dataset.h);
        dayHeads[di]?.classList.remove('active');
        hourHeads[h - startHour]?.classList.remove('active');
      }

      // Toggle pe coloane (zi) ‚Äì include 21:00
      function toggleDay(di){
        const day = days[di];
        let want = false;
        for (let h = startHour; h <= endHour; h++){
          const id = keyOf(day, h);
          if (!selected.has(id)){ want = true; break; }
        }
        beginBatch();
        for (let h = startHour; h <= endHour; h++){
          const id = keyOf(day, h);
          const was = selected.has(id);
          if (setSelected(id, want)) recordChange(id, was, want);
        }
        endBatch();
        updateStatus();
      }
      // Toggle pe r√¢nd (orƒÉ) ‚Äì include 21:00
      function toggleHour(h){
        let want = false;
        for (let d = 0; d < days.length; d++){
          const id = keyOf(days[d], h);
          if (!selected.has(id)){ want = true; break; }
        }
        beginBatch();
        for (let d = 0; d < days.length; d++){
          const id = keyOf(days[d], h);
          const was = selected.has(id);
          if (setSelected(id, want)) recordChange(id, was, want);
        }
        endBatch();
        updateStatus();
      }

      // Undo
      undoBtn.addEventListener('click', ()=>{
        const act = history.pop();
        if(!act) return;
        act.changes.slice().reverse().forEach(ch=> setSelected(ch.id, ch.prev));
        refreshUndo();
        updateStatus();
      });
      function refreshUndo(){ undoBtn.disabled = history.length===0; }

      // Reset
      resetBtn.addEventListener('click', ()=>{
        beginBatch();
        [...selected].forEach(id=>{ recordChange(id,true,false); setSelected(id,false); });
        endBatch();
        updateStatus();
      });

      // Save local
      saveBtn.addEventListener('click', ()=>{
        const data = serialize();
        try{ localStorage.setItem('orarData', JSON.stringify(data)); toastMsg('ModificƒÉri salvate local.', 'ok'); }
        catch(err){ toastMsg('Nu s-a putut salva local.', 'err'); }
      });

      // State de trimitere (loading)
      function setSending(flag){
        const btns = [undoBtn, resetBtn, saveBtn, sendBtn];
        btns.forEach(b=> b.disabled = flag);
        nameInput.disabled = flag;
        if (flag){
          sendBtn.classList.add('loading');
          sendBtn.dataset.label = sendBtn.innerHTML;
          sendBtn.innerHTML = '<span class="spinner"></span> Se trimite‚Ä¶';
        } else {
          sendBtn.classList.remove('loading');
          sendBtn.innerHTML = sendBtn.dataset.label || '‚úàÔ∏è Trimite date';
          updateStatus();
        }
      }

      // Send (webhook ‚Üí Google Apps Script) ‚Äî form-urlencoded pentru a evita preflight
      sendBtn.addEventListener('click', async () => {
        const data = serialize();
        if (!data.nume) { nameInput.focus(); toastMsg('Te rog introdu numele.', 'err'); return; }
        if (data.sloturi.length === 0) { toastMsg('SelecteazƒÉ cel pu»õin un slot.', 'err'); return; }
        if (!navigator.onLine) { toastMsg('E»ôti offline. VerificƒÉ internetul.', 'err'); return; }
        setSending(true);
        toastMsg('Se trimite‚Ä¶', 'info');
        try {
          const resp = await fetch(WEB_APP_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' }, // simple request, fƒÉrƒÉ preflight
            body: JSON.stringify(data)
          });
          const raw = await resp.text();
          if (!resp.ok) {
            toastMsg(`Eroare la trimitere (HTTP ${resp.status}).`, 'err');
            console.error('GAS resp (http error):', resp.status, raw);
            return;
          }
          let out = null;
          try { out = JSON.parse(raw); } catch (e) {
            toastMsg('RƒÉspuns invalid de la server (nu e JSON).', 'err');
            console.error('GAS resp (not JSON):', raw);
            return;
          }
          if (out && out.ok) {
            const n = typeof out.inserted === 'number' ? out.inserted : data.sloturi.length;
            toastMsg(`Trimitere cu succes! (${n} r√¢nd${n===1?'':'uri'})`, 'ok');
          } else {
            const msg = (out && out.error) ? String(out.error) : 'Server a returnat ok:false';
            toastMsg('Eroare server: ' + msg, 'err');
            console.error('GAS resp (ok:false):', out);
          }
        } catch (e) {
          toastMsg('Eroare la trimitere. VerificƒÉ conexiunea/URL.', 'err');
          console.error('Fetch error:', e);
        } finally {
          setSending(false);
        }
      });

      function serialize(){
        const nume = nameInput.value.trim();
        const slots = [...selected].map(id=>{
          const [zi, ora] = id.split('|');
          const h = parseInt(ora.slice(0,2),10);
          const start = `${String(h).padStart(2,'0')}:00`;
          const end = `${String(h+1).padStart(2,'0')}:00`;
          return { zi, start, end };
        }).sort((a,b)=> days.indexOf(a.zi)-days.indexOf(b.zi) || a.start.localeCompare(b.start));
        return { nume, sloturi: slots };
      }

      function updateStatus(){
        const n = selected.size;
        status.textContent = `${n} ${n===1? 'slot selectat' : 'sloturi selectate'}`;
        sendBtn.disabled = !(nameInput.value.trim() && n>0);
      }

      nameInput.addEventListener('input', updateStatus);

      function toastMsg(msg, type='ok'){
        const el = document.createElement('div');
        el.className = `t ${type}`;
        el.textContent = msg;
        toast.appendChild(el);
        requestAnimationFrame(()=>{ el.style.opacity = '1'; });
        setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(4px)'; el.style.transition='all .35s'; }, 2200);
        setTimeout(()=>{ if (el.parentNode) toast.removeChild(el); }, 2700);
      }

      function restore(){
        try{
          const raw = localStorage.getItem('orarData');
          if(!raw) return;
          const data = JSON.parse(raw);
          if(data.nume) nameInput.value = data.nume;
          if(Array.isArray(data.sloturi)){
            data.sloturi.forEach(s=>{
              const h = parseInt(s.start.slice(0,2),10);
              const id = keyOf(s.zi, h);
              if(findCell(id)) setSelected(id,true);
            });
          }
        }catch(e){}
        updateStatus();
      }

      restore();
      document.getElementById('y').textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
